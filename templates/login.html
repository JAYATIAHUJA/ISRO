{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .star-canvas-bg {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        z-index: 0;
        pointer-events: none;
        display: block;
    }
    .login-planet {
        position: absolute;
        border-radius: 50%;
        z-index: 1;
        opacity: 0.7;
        filter: blur(0.5px);
    }
  
    .login-form-center .form-label {
        margin-bottom: 0;
        margin-right: 1rem;
        min-width: 80px;
        text-align: right;
        font-size: 1.08rem;
        color: #ffd700;
        align-self: center;
    }
    .login-form-center .form-group-flex {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.5rem;
    }
    .login-form-center input,
    .login-form-center select,
    .login-form-center textarea {
        width: 90%;
        max-width: 320px;
        min-width: 120px;
        text-align: center !important;
        margin-left: 0;
        margin-right: 0;
        display: block;
    }
    .login-orbit-wrapper {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh;
        z-index: 2;
    }
    .login-card-orbit {
        position: relative;
        z-index: 2;
        background:rgba(35,39,43,0.98);
        border-radius:1rem;
        min-width:350px;
        max-width:400px;
        padding: 2.5rem 2rem 2rem 2rem;
        box-shadow: 0 8px 32px #0004;
        overflow: visible;
    }
    .orbit-planet {
        position: absolute;
        width: 54px;
        height: 54px;
        border-radius: 50%;
        z-index: 1;
        pointer-events: none;
        box-shadow: 0 0 24px 6px #00eaff33;
    }
    @media (max-width: 600px) {
        .orbit-planet { width: 36px; height: 36px; }
    }
</style>
<canvas id="star-canvas" class="star-canvas-bg"></canvas>
<script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js"></script>
<div class="login-orbit-wrapper">
    <img src="{% static 'assets/neptune.png' %}" class="orbit-planet" id="planet-neptune" alt="Neptune">
    <img src="{% static 'assets/mars.png' %}" class="orbit-planet" id="planet-mars" alt="Mars">
    <img src="{% static 'assets/moon.png' %}" class="orbit-planet" id="planet-moon" alt="Moon">
    <div class="login-card-orbit">
        <div style="display: flex; justify-content: center; align-items: center; width: 100%;">
            <dotlottie-player
              src="https://lottie.host/6b7ed1b1-36ec-4f7e-92d0-52f45e7f32ae/k5mzhI50E3.lottie"
              background="transparent"
              speed="1"
              style="width: 150px; height: 150px; margin-bottom: 1.5rem;"
              loop
              autoplay
            ></dotlottie-player>
        </div>
        <h2 class="text-center mb-4" style="color:#00eaff; margin-bottom: 2.2rem !important;">Login</h2>
        <form method="post" novalidate class="login-form-center">
            {% csrf_token %}
            {% if form.errors %}
                <div class="alert alert-warning text-center" style="background:rgba(255,215,0,0.08); color:#ffd700; border:none;">
                    Looks like you don't have an account, please <a href="/signup/" style="color:#00eaff; text-decoration:underline;">sign up first</a>.
                </div>
            {% endif %}
            {% for field in form %}
                <div class="form-group-flex">
                    <label class="form-label">{{ field.label }}</label>
                    {{ field }}
                </div>
                {% if field.errors %}
                    <div class="text-danger small" style="margin-top: -1rem; margin-bottom: 1rem; text-align: center;">{{ field.errors|striptags }}</div>
                {% endif %}
            {% endfor %}
            <button type="submit" class="btn btn-primary w-100" style="background:#00eaff; border:none; padding: 0.75rem 0; font-size: 1.1rem; margin-top: 0.5rem;">Login</button>
        </form>
        <div class="mt-4 text-center" style="margin-top: 2rem !important;">
            <span style="color:#b0eaff;">Don't have an account?</span> <a href="/signup/" style="color:#ffd700;">Sign up</a>
        </div>
    </div>
</div>
<script>
gsap.registerPlugin(MotionPathPlugin);
// Get card dimensions for orbit radius
const card = document.querySelector('.login-card-orbit');
const rect = card.getBoundingClientRect();
const w = rect.width || 400;
const h = rect.height || 400;
const cx = w/2, cy = h/2;
const rx = (w/2) + 70, ry = (h/2) + 40;
// Animate planets in elliptical orbits around the card
function ellipsePath(angleOffset=0) {
    return Array.from({length: 101}, (_,i) => {
        const t = (i/100)*2*Math.PI + angleOffset;
        return {x: cx + rx*Math.cos(t) - 27, y: cy + ry*Math.sin(t) - 27};
    });
}
gsap.to('#planet-neptune', {
    duration: 10,
    repeat: -1,
    ease: 'none',
    motionPath: {
        path: ellipsePath(0),
        autoRotate: false
    }
});
gsap.to('#planet-mars', {
    duration: 13,
    repeat: -1,
    ease: 'none',
    motionPath: {
        path: ellipsePath(2),
        autoRotate: false
    }
});
gsap.to('#planet-moon', {
    duration: 16,
    repeat: -1,
    ease: 'none',
    motionPath: {
        path: ellipsePath(4),
        autoRotate: false
    }
});
// Starfield with subtle, realistic constellation clusters
const canvas = document.getElementById('star-canvas');
const ctx = canvas.getContext('2d');
let ww = window.innerWidth, hh = window.innerHeight;
canvas.width = ww; canvas.height = hh;
function resizeCanvas() {
    ww = window.innerWidth; hh = window.innerHeight;
    canvas.width = ww; canvas.height = hh;
}
window.addEventListener('resize', resizeCanvas);
function Star(x, y) {
    this.x = x !== undefined ? x : Math.random() * ww;
    this.y = y !== undefined ? y : Math.random() * hh;
    this.radius = Math.random() * 0.9 + 0.2;
    this.speed = Math.random() * 0.04 + 0.01;
    this.alpha = Math.random() * 0.3 + 0.2;
    this.twinkle = Math.random() * 0.3 + 0.2;
    this.twinkleSpeed = Math.random() * 0.01 + 0.005;
    this.baseAlpha = this.alpha;
}
Star.prototype.update = function() {
    this.x += this.speed;
    if (this.x > ww) this.x = 0;
    this.alpha = this.baseAlpha + Math.sin(Date.now() * this.twinkleSpeed + this.x) * this.twinkle * 0.5;
};
Star.prototype.draw = function(ctx) {
    ctx.save();
    ctx.globalAlpha = Math.max(0, Math.min(1, this.alpha));
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
    ctx.fillStyle = '#fff';
    ctx.shadowColor = '#fff';
    ctx.shadowBlur = 6;
    ctx.fill();
    ctx.restore();
};
const STAR_COUNT = 100;
let stars = [];
for (let i = 0; i < STAR_COUNT; i++) stars.push(new Star());
// Define a few small clusters (constellations) with short lines
const clusters = [
    [
        new Star(ww*0.18, hh*0.22),
        new Star(ww*0.21, hh*0.25),
        new Star(ww*0.19, hh*0.28)
    ],
    [
        new Star(ww*0.65, hh*0.60),
        new Star(ww*0.68, hh*0.62),
        new Star(ww*0.66, hh*0.65),
        new Star(ww*0.69, hh*0.64)
    ],
    [
        new Star(ww*0.45, hh*0.15),
        new Star(ww*0.47, hh*0.18),
        new Star(ww*0.49, hh*0.16)
    ]
];
function drawClusters(ctx, clusters) {
    ctx.save();
    ctx.strokeStyle = '#00eaff';
    ctx.globalAlpha = 0.18;
    ctx.lineWidth = 1.1;
    clusters.forEach(cluster => {
        for (let i = 0; i < cluster.length; i++) {
            for (let j = i+1; j < cluster.length; j++) {
                // Only connect if distance is short
                const dx = cluster[i].x - cluster[j].x;
                const dy = cluster[i].y - cluster[j].y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 60) {
                    ctx.beginPath();
                    ctx.moveTo(cluster[i].x, cluster[i].y);
                    ctx.lineTo(cluster[j].x, cluster[j].y);
                    ctx.stroke();
                }
            }
        }
    });
    ctx.restore();
}
function animate() {
    ctx.clearRect(0, 0, ww, hh);
    for (let s of stars) {
        s.update();
        s.draw(ctx);
    }
    // Draw clusters
    drawClusters(ctx, clusters);
    // Draw cluster stars
    clusters.forEach(cluster => {
        cluster.forEach(s => s.draw(ctx));
    });
    requestAnimationFrame(animate);
}
animate();
</script>
{% endblock %} 